\documentclass{article}
\usepackage{colortbl,footnote,fullpage}%,pointtables}
\usepackage[perpage,symbol*]{footmisc}

% We need to do stuff like this to pull things out of the aux file safely.
\ifx\test\undef
  \def\test{placeholder}
\fi

\let\xa\expandafter

\def\cellcol#1#2{\multicolumn{1}{>{\columncolor{#1}}c}{#2}}
\let\mc\multicolumn

\def\cellcol#1#2{\multicolumn{1}{>{\columncolor{#1}}c}{#2}}
\def\mc#1#2{\multicolumn{#1}{c}{#2}}
\def\mcc#1#2#3{\multicolumn{#1}{>{\columncolor{#2}}c}{#3}}

\definecolor{lblue}{rgb}{.75,.8,1}
\definecolor{lred}{rgb}{1,.8,.8}
\definecolor{lgreen}{rgb}{.8,1,.8}
\definecolor{lorange}{rgb}{1,.9,.7}
\definecolor{lpurple}{rgb}{.95,.7,1}
\definecolor{lyellow}{rgb}{1,1,.6}
\definecolor{laqua}{rgb}{.65,.95,1}

% See if we can't get better colors (both values and names and meanings)
% Forcing
% Game Forcing
% Invitational
% Slam asking?
% Asking/telling?
% Captain?
% - Striped background for responses which are off after interference
%   (various kinds for off after double and/or overcall??)

\newcommand{\cb}[2]{\mcc#1{lblue}{#2}}
\newcommand{\cp}[2]{\mcc#1{lred}{#2}}
\newcommand{\cg}[2]{\mcc#1{lgreen}{#2}}
\newcommand{\co}[2]{\mcc#1{lorange}{#2}}
\newcommand{\cv}[2]{\mcc#1{lpurple}{#2}}
\newcommand{\cy}[2]{\mcc#1{lyellow}{#2}}

\def\C{$\clubsuit$}
\def\D{$\diamondsuit$}
\def\H{$\heartsuit$}
\def\S{$\spadesuit$}
\def\NT{\textsc{nt}}
\let\TeXto\to
\let\TeXge\ge
\let\TeXle\le
\def\to{$\TeXto$}
\def\lt{$<$}
\def\gt{$>$}
\def\le{$\TeXle$}
\def\ge{$\TeXge$}
\def\ltsim{$\lesssim$}
\def\gtsim{$\gtrsim$}

\makesavenoteenv{tabular}

\begin{document}

\iffalse
\test
\newcolumntype{C}{>{\phantom{m}}c<{\phantom{m}}}
\newcolumntype{W}{c<{\phantom{m}}>{\phantom{m}}c}
\newcolumntype{R}{c<{\phantom{m}}>{\phantom{n}}c<{\phantom{n}}>{\phantom{m}}c}

\begin{tabular}{lcccccccccc}
\hline
\cellcol{black}{} & \co1{0--6} & \cb1{6--8} & \cg2{8--10} & \cp1{10--12} & \cv1{13--14} & \cp1{15--16} & \cg1{17--19} & \cb1{20--22} & \co1{23+}\\\hline\hline
Opening && \co4{Weak 2} & \cb2{Min} & \cg1{Inv} & \cp1{Max} & \cv1{Strong 2}\\\hline
Response && \cb3{Weak} & \cg1{Inv} & \cp5{Strong}\\\hline\hline

Direct o/c &&&\phantom{r}& \cg7{Overcall}\\\hline
Takeout Dbl &&&&&&&& \cp3{Strong}\\\hline

Invit'l cuebid &&&&\phantom{r}& \cb1{Raise} & \cp5{Raise or Shift}\\\hline
Michaels && \co4{Weak} &&& \cp3{Strong}\\\hline
Unusual NT && \co4{Weak} &&& \cp3{Strong}\\\hline
\hline
\end{tabular}

\colorbox{lblue}{\vbox to 2 in{\hbox to 2in{Testing 12 13 14 15}\hbox to 2in{a b c d ef\hss}}}
% Could make i.e. \row[height=2pc]\cell[4]{...}\cell[3]{...}
% in terms of units set at the top..  But how to scale properly?
% Would like to make it as narrow as possible, to accomodate everything.
% We could accumulate box widths and then divide to keep a running total
% of the minimum length of the unit.

%\beginbidtable abc\endbidtable
\eject
\fi

\makeatletter
\let\xa\expandafter
\newcount\c@a\newcount\c@b\newcount\c@c
\newif\ifplus
\def\@gobble@null\@null{}
\def\@maybe@next{\ifx\@foo\@null\let\@next\@gobble@null\fi\@next}
\def\@headings#1|{\doheading#1-.-\@end\let\@next\@headings\futurelet\@foo\@maybe@next}
\def\headings#1{\global\c@c\z@\@headings#1|\@null\\\hline\hline}
\def\stripplus#1+#2\@null{\ifx+#2\relax\plustrue\else\plusfalse\fi\c@a#1\relax}
\def\setupper#1#2\@null{\ifx.#1\relax\number\c@a\relax\c@b\c@a\relax\else\c@b#1#2\relax\number\c@a--\number\c@b\fi\ifplus+\fi}
\def\doheading#1-#2-#3\@end{%
  &%  \ifnum\c@c>\z@&\fi
  \stripplus#1+\@null % sets \ifplus and \c@a
  \setupper#2\@null   % sets \c@b and prints stuff
  \xa\xdef\csname a@\romannumeral\c@a\endcsname{\number\c@c}%
  \xa\xdef\csname b@\romannumeral\c@b\endcsname{\number\c@c}%
  \global\advance\c@c\@ne % next column...
}


\def\test{&1&2&3}

\def\getleft{\xa\c@a\csname a@\romannumeral\c@a\endcsname}
\def\getright{\xa\c@b\csname b@\romannumeral\c@b\endcsname}

\def\row{\c@c\z@}
\def\@@lign{%
  \t@b%  % This should work now...
  \let\@next\@@lign
  \ifnum\c@c<\c@a
    \global\advance\c@c\@ne
  \else
    \let\@next\relax
  \fi\@next}

\newcount\@left
\newcount\@cur

\def\t@b{&}
\def\@lign{%
  \global\@left\c@a % copy this value
  \global\advance\@left-\@cur % find out how many more we need to go.
  \ifnum\@left>\z@  % SOMEHOW, this counter is getting changed on me!!!
    \t@b\xa\multicolumn\xa{\number\@left}{c}{}\t@b%
  \else\t@b\fi
}

\def\@bid#1#2#3#4{%
\c@a#1\relax\getleft % \c@c stores the current position in the row...
\c@b#2\relax\getright\advance\c@b\@ne
\global\@cur\c@c\relax\global\c@c\c@b\relax % make sure to update it...
\global\advance\c@b-\c@a\relax
\@lign\mcc{\number\c@b}{#3}{#4}%
}
\def\resolverange#1-#2-#3\@null{{#1}{#2}}
\def\@@bid#1#2#3{% #1 is a range
\xa\@bid\resolverange#1-#1-\@null{#2}{#3}}

\newif\if@star
\newif\if@usingstar
\global\@usingstartrue
\def\bid{\futurelet\@foo\check@star}
\def\check@star{\let\@next\@nsbid
  \ifx\@foo*\relax
    \if@usingstar\global\@startrue\fi
%    \global\let\if@star\if@usingstar % bad syntax...
    \let\@next\@sbid
  \else
    \global\@starfalse
  \fi\@next}
\def\@sbid*{\@nsbid}
\def\@nsbid(#1,#2)#3{\@@bid{#1}{#2}{\if@star\else#3\fi}}

\def\clear@ranges{\count@40\let\@next\@clr@ranges\@next}
\def\@clr@ranges{\ifnum\count@<\z@\let\@next\relax\else
  \xa\global\xa\let\csname a@\romannumeral\count@\endcsname\undef
  \xa\global\xa\let\csname b@\romannumeral\count@\endcsname\undef
  \global\advance\count@\m@ne
\fi\@next}

\def\b@ptable{\begin{tabular}{lccccccccccccccccccccc}} % should be enough...
\def\e@ptable{\hline\end{tabular}\clear@ranges}

\def\gap{\\[-.6pc]}
\newcommand{\drop}[2][0.52pc]{\setbox0\hbox{\lower #1\hbox{#2}}\dp0=0pt\ht0=0pt\box0}
\newcommand{\cdrop}[2][0.52pc]{\if@usingstar\setbox0\hbox{\lower #1\hbox{#2}}\dp0=0pt\ht0=0pt\box0\else#2\fi}

\newenvironment{ptable}{\b@ptable}{\e@ptable}

\def\ob#1#2{\@@bid{#1}{lorange}{#2}}
\def\yb#1#2{\@@bid{#1}{lyellow}{#2}}
\def\gb#1#2{\@@bid{#1}{lgreen}{#2}}
\def\bb#1#2{\@@bid{#1}{lblue}{#2}}
\def\pb#1#2{\@@bid{#1}{lred}{#2}}
\def\vb#1#2{\@@bid{#1}{lpurple}{#2}}
\def\ab#1#2{\@@bid{#1}{laqua}{#2}}

% There MUST be better ways to do this...
\def\oc#1#2{\@@bid{#1}{lorange}{}}
\def\yc#1#2{\@@bid{#1}{lyellow}{}}
\def\gc#1#2{\@@bid{#1}{lgreen}{}}
\def\bc#1#2{\@@bid{#1}{lblue}{}}
\def\pc#1#2{\@@bid{#1}{lred}{}}
\def\vc#1#2{\@@bid{#1}{lpurple}{}}
\def\ac#1#2{\@@bid{#1}{laqua}{}}

\def\ic{\futurelet\@foo\@ic}
\def\@ic{\let\@next\g@ic\ifx\@foo\egroup\let\@next\relax\fi\@next}
\def\g@ic#1{\futurelet\@foo\@ic}

\def\ditto#1{\raise 0.18pc\hbox to #1{\leaders\hrule\hfill\lower 0.4pc\hbox{\kern1ex''\kern0.6ex}\leaders\hrule\hfill}}

\def\savenote#1#2{\begingroup\count@\value{footnote}\advance\count@\@ne\xdef#1{\the\count@}\endgroup\footnote{#2}}
%\def\savenote#1#2{\footnote{#2}\xdef#1{\value{footnote}}}

\section{Openings}

\begin{ptable}\headings{0-5|6-8|9-12|13-14|15-16|17|18-19|20-22|23+}
\row{balanced}
%  \[13-14,G]{...}
  \bid(13-14,lgreen){}
%  \bid(15-17,lblue){\vbox{\hbox{\vsize=.5pc\tiny 1NT}\hbox{\vsize=.5pc\colorbox{lgreen}{\tiny1/1,2/1}}}} % UGLY...
  \bid(15-17,lblue){1NT}
  \bid(18-19,lgreen){}
  \bid(20-22,lred){2NT}
  \bid*(23,lpurple){2\C}\\%\hline
\row{openable suit\footnote{Opening a suit requires 5 of a major or 4 of a minor}}
  \bid*(13-22,lgreen){1\C\D\H\S}
  \bid*(23,lpurple){2\C}\\%\hline
\row{6 card suit}
  \bid(6-12,lyellow){2\D\H\S}
  \bid(13-22,lgreen){1\C\D\H\S}
  \bid(23,lpurple){\cdrop[-.45pc]{2\C}}\\%\hline
\row{7 card suit}
  \bid(0-8,lorange){\ge3\C\D\H\S}
  \bid*(9-12,lyellow){2\D\H\S}
  \bid*(13-22,lgreen){1\C\D\H\S}
  \bid*(23,lpurple){2\C}\\
\end{ptable}

\section{Responses to 1 of a suit}
\textbf{Limit Major Raises}, \textbf{Jacoby 2NT},
\textbf{Splinter Bids}, \textbf{Weak Jump Shifts}, and \textbf{Inverted
Minor Raises}\\

\noindent\begin{ptable}\headings{2-6|6-10|11-12|13+}
\row{three-card major suit fit}
  \bid*(6-10,lblue){single raise (2M)}
  \bid*(11-12,lgreen){limit raise (3M)}
  \bid(13,laqua){1/1 or 2/1}\\
\row{four-card major suit fit}
  \bid(6-10,lblue){single raise (2M)}
  \bid(11-12,lgreen){limit raise (3M)}
%  \bid(6-12,white){\ditto{2in}}
  \bid(13,lpurple){Jacoby 2NT}\\
%\row{\ldots\ + 1$^{\underline{\mathrm{tn}}}$/void}
\row{\ldots\ + singleton/void}
  \bid*(6-10,lblue){single raise (2M)}
  \bid*(11-12,lgreen){limit raise (3M)}
%  \bid(6-12,white){\ditto{2in}}
  \bid(13,lyellow){splinter bid\footnote{Splinter bid is a double-jump (non-game) bid in new suit, showing a singleton.}}\\\\[-.6pc]
%\row{5 trump fit}
%  \bid(7-10){preempt to game (4M)}
\row{four-card minor suit fit}
  \bid(6-10,lblue){jump raise (3m)\footnote{Prefer 1NT with a bare 10-point raise}}
  \bid(11-13,lgreen){single raise (2m)}\\\\[-.6pc]
\row{\drop{new suit\footnote{All new suits require at least 4 cards.
After a minor suit opening, prefer bidding 4-card suits up the line
at the 1-level.  2\H\ requires a five-card suit.  Weak jump preempts
require roughly 6 cards at the 2-level and 7 at the 3-level.}}}
  \bid*(2-6,lorange){jump shift}
  \bid(6-10,lblue){1NT\savenote{\ntresp}{1NT response/rebid denies a biddable 1-level major}}
  \bid(11-13,lgreen){2/1}\\
\row{}%\row{\phantom{m}\ditto{0.6in}}
  \bid(2-6,lorange){\cdrop[-.45pc]{jump shift}}
  \bid(6-13,laqua){1/1}\\%\\[-.6pc]
%\row{six-card suit}
%  \bid(2-6,lorange){jump shift\savenote{\weakshift}{Weak jump shifts 
%      at the three level \emph{must} have a slightly longer suit, 
%      and \emph{may} show an extra point or two}}
%  \bid(6-13,white){\ditto{3in}}\\
%four-card suit%\footnote{2\H requires 5 cards}
%(5 to bid 2\H)&\co1{preempt\footnote{double jump shift requires 7-card suit}}&\cy1{1NT}&\cg4{2/1}\\
\end{ptable}

\section{Responses to 1NT}
\begin{ptable}\headings{0-7|8|9-10|11-15|16+}
\row{(semi)balanced}
  \bid(9-10,lblue){2NT}
  \bid(11-15,lred){3NT}
  \bid(16,lpurple){4NT}\\
\row{five-card major}
  \bid(0-16,lgreen){Jacoby transfer 2\D\H}\\
\row{four-card major}
  \bid(8-16,lyellow){Stayman 2\C}\\
\row{5 or 6-card minor}
  \bid(0-7,lorange){3\C\D\footnote{minor suit bust requires 6 cards}}
  \bid*(11-16,lyellow){Stayman 2\C}\\
\row{444 in \D\H\S}
  \bid(0-7,lyellow){Stayman 2\C, then Pass}
  \bid(8-16,white){\ditto{1.7in}}\\
\end{ptable}

\section{Responses to 2NT}
\begin{ptable}\headings{0-7|8|9-10|11-15|16+}
\row{(semi)balanced}
  \bid(9-10,lblue){2NT}
  \bid(11-15,lred){3NT}
  \bid(16,lpurple){4NT}\\
\row{five-card major}
  \bid(0-16,lgreen){Jacoby transfer 2\D\H}\\
\row{four-card major}
  \bid(8-16,lyellow){Stayman 2\C}\\
\row{5 or 6-card minor}
%  \bid(0-7,lorange){3\C\D (w/ 6+ cards)}
  \bid(11-16,lyellow){(rebid minor)}\\
\end{ptable}

\section{Responses to Strong 2\C}
\begin{ptable}\headings{0-8|9+}
\row{long suit}\bid*(0-8,lorange){2\D}\bid(9,lpurple){2M, 3m}\\
\row{balanced}\bid(0-8,lorange){\cdrop[-.45pc]{2\D}}\bid(9,lred){2NT}\\
\end{ptable}

\section{Responses to Weak 2}
\begin{ptable}\headings{0-4|5+}
\row{Support}\bid(0-5,lgreen){raise}\\
\end{ptable}

% Organization: Do we want to do all the responses first,
% and then the rebids, or do we want to separate out the
% various types of auctions and show all responses and rebids
% from there?  Probably the latter...

\section{Opener's rebids after 1/1}
\begin{tabular}{lcccc}
&\mc2{13--16}&\mc1{17--19}&\mc1{20--22}\\\hline\hline
fit (4 trump)&\cb2{single raise}&\cg1{jump raise}&\cv1{reverse, jump shift}\\\hline
balanced & \cy1{1NT\footnotemark[\ntresp]%{1NT response after 1/1 gaurantees no 4-card major at 1-level}%
}&&\cp1{2NT (w/stops)}&\\\hline
4-card unbid suit &\cg3{non-reverse}&\cv1{jump shift}\\
                &&&\cp2{reverse}\\\hline
6-card original suit &\cy2{rebid suit}&\cb1{jump rebid}\\\hline
\end{tabular}

\subsection{1/1 bidder's rebids after opener's single raise}
6--10 points: Pass\\
11--12 points: Invite game in suit only at 3-level.  Invite game in either
suit or notrump with 2NT.  An unbid suit invites game in agreed-upon suit,
but shows side honors or length.  3 of opener's original suit shows only
4-cards in own suit, but good fit in opener's suit, invites game.\\
13+ points: Bid game, or bid or investigate slam

\subsection{1/1 bidder's rebids after opener rebids 1NT (minimum)}
6--10 points: Scramble for a safe part-score (non-reverse, non-jump)\\
11--12 points: 2NT, or over/under-bid\\
13+ points: Reverse or jump bidding

\subsection{1/1 bidder's rebids after opener's nonjump rebid of original suit}
6--10 points: Pass, unless \le1 trump \emph{and} a 6-card suit to escape to\\
11--12 points: Show another (4-card) suit (forcing one round), or 2NT with
unbid suits stopped, or raise with as meager as 2-card major or 3-card minor 
support\\
13+ points: Bid game if known, or forcing new suit otherwise

\subsection{1/1 bidder's rebids after opener's non-reversing shift to unbid suit}
6 points: Pass\\
7--10 points: 1NT if balanced and no fit, or show preference for one of opener's suits at 2-level\\
11--12 points: (non-jumping) 2NT with last suit stopped, fourth suit (forcing),
invite game in one of opener's suits with non-jump to 3-level; jump from a 
passed hand\\
13+ points: jump
\subsubsection{1NT responder's rebids after opener's non-reversing shift}
Prefer second suit with 4-card support, bid 6-card suit at 2-level, or 7-card
suit at 3-level.

\subsection{1/1 bidder's rebids after opener's reverse}
6--8 points: 2NT with last stopper, or nonjump in either of first two suits\\
9+ points (game-forcing): fourth suit, raise third suit (4 trump), jump first suit, 3NT

\subsection{1/1 bidder's rebids after opener's jump bid}
\subsubsection{After opener's jump raise, jump rebid, or 2NT}
Pass with 6--7, bid suit or NT game with 8+.
\subsubsection{After opener's jump shift}
Bid naturally to show strength.  Game is required.

\section{Opener's rebids after 2/1}
% GRR...  these tables are a pain, especially for stupid systems
\begin{tabular}{lcccc}
&\mc1{13--14}&\mc1{15--16}&\mc1{17--19}&\mc1{20+}\\\hline\hline
fit (4 trump)&\cb2{single raise}&\cg1{jump raise}&\cv1{reverse, jump shift}\\\hline
balanced & \cy1{1NT}&&\cp1{2NT (w/stops)}&\\\hline
4-card unbid suit &\cg3{non-reverse}&\cv1{jump shift}\\
                &&&\cp2{reverse}\\\hline
6-card original suit &\cy2{rebid suit}&\cb1{jump rebid}\\\hline
\end{tabular}

\section{Responses to 1 of a suit with LIMIT RAISES}
\begin{tabular}{lccccccccc}
&\mc1{4--6}&\mc1{6--10}&\mc1{11--12}&\mc1{13--16}&\mc1{17--19}&\mc1{20+}\\\hline\hline
fit (3 major, 4 minor)&\co1{preempt\footnote{double jump raise requires 5 trump}}&\cb1{single raise}&\cg1{jump raise}&\cv3{splinter bid or Jacoby 2NT}\\\hline
four-card suit%\footnote{2\H requires 5 cards}
&&\cg5{1/1}\\
(5 to bid 2\H)&\co1{preempt\footnote{double jump shift requires 7-card suit}}&\cy1{1NT}&\cg4{2/1}\\\hline
\hline
\end{tabular}\\

\makeatletter
%\protected@write\@auxout{\string\def\expandafer\string\test{testing}}{
%\def\@@@{4}
%\protected@write\@auxout{}{\string\def\expandafter\string\csname test\@@@\endcsname{testing}}
\protected@write\@auxout{}{\string\gdef\expandafter\string\csname test\endcsname{testing}}
%\makeatother
% The point - use a counter to count the tables, then use the aux file
% to store the correct widths for all of them in a counted command.

\end{document}
